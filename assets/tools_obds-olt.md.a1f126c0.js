import{a as f}from"./chunks/axios.c0bebe37.js";import{X as a}from"./chunks/xlsx.4d56fc9a.js";import{g as c}from"./chunks/utils.26f32e71.js";import{a as D}from"./chunks/config.628e1703.js";import{_ as O,o as d,c as _,b as r,w as p,q as k,f as u,v as y,t as w,d as v,e as B}from"./app.e08fe782.js";const h="OBD列表",T="OBD_ID",C={data(){return{import_type:"xlsx",textarea_text:"",olt_list:[],obdid_list:[],message:{show:!1,text:""},genCompleted:!1}},methods:{queryObdData(){this.message.show=!0,this.queryAllOlt(this.obdid_list)},onTextChange(){this.obdid_list=[],this.textarea_text.split(/\s+/).forEach(t=>{t.length>0&&!/\D/.test(t)&&(console.log(t),this.obdid_list.push(t))}),console.log(this.obdid_list)},queryAllOlt(n){this.olt_list=[];let t=0,s=[];n.forEach((i,o)=>{s.push(f.post(D(),{dev_id:i}))}),Promise.all(s).then(i=>{i.forEach(o=>{if(o.data.code=="0000"){let l=o.data.data,e=l.qrcode_id,x=l.name,m=l.code,b=l.oltMap.up_olt_info.olt_pon,g=l.oltMap.up_olt_info.olt_manage_ip;this.olt_list.push({OBD_NAME:x,OBD_CODE:m,QRCODE:e,OLT_PON:b,OLT_IP:g}),t++,this.message.text="成功获取"+t+"个，共"+this.obdid_list.length+"个"}})}).catch(i=>{console.log(i),this.message.text=i})},readWorkbookFromLocalFile:function(n,t){let s=new FileReader;s.onload=function(i){let o=i.target.result,l=a.read(o,{type:"binary"});t&&t(l)},s.readAsBinaryString(n)},getOBDData:function(n){if(n.srcElement.files.length>0){let t=n.srcElement.files[0];try{this.readWorkbookFromLocalFile(t,s=>{let i=s.Sheets[h],o=a.utils.sheet_to_json(i);this.obdIdList=[],o.forEach(l=>{let e=l[T];e!=null&&e.length>0&&!/\D/.test(e)&&this.obdid_list.push(e)}),console.log(this.obdid_list)})}catch(s){alert("导入obd编码时发生错误:"+s)}}},genXslx:function(){this.olt_list.sort((l,e)=>l.OLT_PON.localeCompare(e.OLT_PON));let n=this.olt_list[0].OBD_NAME.split("_")[3].substring(0,4),t=this.olt_list,s=a.utils.json_to_sheet(t);s["!cols"]=[{wch:30},{wch:15},{wch:18},{wch:22}];let i=a.utils.book_new();const o=a.utils.decode_range(s["!ref"]);o.e.c=t.length-1,s["!ref"]=a.utils.encode_range(o),a.utils.book_append_sheet(i,s,h),a.writeFile(i,"OBD_OLT列表-"+n+"-"+c()+".xlsx")},genXslxTemplate(){let n=[];n.push({OBD_ID:""});let t=a.utils.json_to_sheet(n);t["!cols"]=[{wch:12}];let s=a.utils.book_new();const i=a.utils.decode_range(t["!ref"]);i.e.c=n.length-1,t["!ref"]=a.utils.encode_range(i),a.utils.book_append_sheet(s,t,h),a.writeFile(s,"OBD_ID列表_导入模板"+c()+".xlsx")}},components:{},mounted(){console.log("ok")}},N=r("h2",null,"获取olt列表",-1),X=r("option",{value:"text"},"文本框输入",-1),E=r("option",{value:"xlsx"},"XLSX ",-1),L=[X,E],q={key:0},I={key:0},F={key:1},S=r("br",null,null,-1),M=r("label",null,"OBD ID列表：",-1),P=r("br",null,null,-1),V={key:3};function j(n,t,s,i,o,l){return d(),_("div",null,[N,r("div",null,[p(r("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.import_type=e)},L,512),[[k,o.import_type]])]),o.import_type=="text"?(d(),_("div",q,[o.textarea_text.length>0?(d(),_("div",I,[r("button",{onClick:t[1]||(t[1]=e=>this.textarea_text="")},"清除输入")])):u("",!0),p(r("textarea",{rows:"10","onUpdate:modelValue":t[2]||(t[2]=e=>o.textarea_text=e),placeholder:"粘贴obd ID列表,一行一个",style:{border:"1px solid black",width:"100%"},onInput:t[3]||(t[3]=(...e)=>l.onTextChange&&l.onTextChange(...e))},`
            `,544),[[y,o.textarea_text]])])):u("",!0),o.import_type=="xlsx"?(d(),_("div",F,[r("button",{onClick:t[4]||(t[4]=(...e)=>l.genXslxTemplate&&l.genXslxTemplate(...e))},"获取模板"),S,M,r("input",{type:"file",onChange:t[5]||(t[5]=(...e)=>l.getOBDData&&l.getOBDData(...e)),accept:".xlsx"},null,32),P])):u("",!0),o.obdid_list.length?(d(),_("button",{key:2,onClick:t[6]||(t[6]=(...e)=>l.queryObdData&&l.queryObdData(...e))},"开始遍历")):u("",!0),o.message.show?(d(),_("div",V,w(o.message.text),1)):u("",!0),o.olt_list.length?(d(),_("button",{key:4,onClick:t[7]||(t[7]=(...e)=>l.genXslx&&l.genXslx(...e))},"导出文件")):u("",!0)])}const A=O(C,[["render",j]]),U=r("h1",{id:"获取obd-olt",tabindex:"-1"},[B("获取obd olt "),r("a",{class:"header-anchor",href:"#获取obd-olt","aria-hidden":"true"},"#")],-1),H=JSON.parse('{"title":"获取obd olt","description":"","frontmatter":{},"headers":[],"relativePath":"tools/obds-olt.md","lastUpdated":null}'),Q={name:"tools/obds-olt.md"},K=Object.assign(Q,{setup(n){return(t,s)=>(d(),_("div",null,[U,v(A)]))}});export{H as __pageData,K as default};
