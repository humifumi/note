import{X as i}from"./chunks/xlsx.4d56fc9a.js";import{_ as m,o as c,c as h,b as r,w as b,k as x,e as u,f,d as _}from"./app.e08fe782.js";const g="OBD清单",w={data(){return{appendObdId:!1,obdList:[],ofsData:null,fin:"",communityName:"",xslxdata:{}}},methods:{parseOfsData(t){let e=t.indexOf("("),a=t.substring(e+1),n=a.lastIndexOf(")"),s=a.substring(0,n),l=JSON.parse(s).datas;if(l.length>0)this.communityName=l[0].newDirectName.substring(0,2),this.ofsData=l;else throw this.ofsData=null,Error("无工单数据")},readJsonFromFile:function(t){let e=new FileReader;e.onload=a=>{let n=a.target.result;this.parseOfsData(n)},e.readAsText(t)},lastnword(t,e){let a=t.toString().padStart(e,"0");return a.substring(a.length-e)},genFormatTime(){let t=new Date,e=this.lastnword(t.getFullYear(),2),a=this.lastnword(t.getMonth()+1,2),n=this.lastnword(t.getDate(),2),s=this.lastnword(t.getHours(),2),o=this.lastnword(t.getMinutes(),2);return"_"+e+"_"+a+n+"_"+s+o},genData:function(){let t=[];this.appendObdId?this.ofsData.forEach(s=>{let o,l;s.obdName!=null&&this.obdList.forEach(d=>{d.设备名称==s.obdName&&(o=d.ID,l=d.设备编码)}),t.push({备注:"",账号:s.pppoe,小区名称:s.newDirectName,obdID:o,设备编码:l,obd名称:s.obdName,地址:s.installAddress}),t=t.sort((d,p)=>d.obd名称.localeCompare(p.obd名称))}):this.ofsData.forEach(s=>{t.push({备注:"",账号:s.pppoe,小区名称:s.newDirectName,地址:s.installAddress,obd名称:s.obdName}),t=t.sort((o,l)=>o.地址.localeCompare(l.地址))});let e=i.utils.json_to_sheet(t);this.appendObdId?e["!cols"]=[{wch:12},{wch:19},{wch:12},{wch:22},{wch:12},{wch:75},{wch:150}]:e["!cols"]=[{wch:12},{wch:19},{wch:12},{wch:150},{wch:75}];let a=i.utils.book_new();const n=i.utils.decode_range(e["!ref"]);n.e.c=t.length-1,e["!ref"]=i.utils.encode_range(n),i.utils.book_append_sheet(a,e,"尾纤码化工单"),i.writeFile(a,"尾纤码化工单-"+this.communityName+this.genFormatTime()+".xlsx")},getData:function(t){if(t.srcElement.files.length>0){let e=t.srcElement.files[0];try{this.readJsonFromFile(e)}catch(a){alert("发生工单数据时发生错误：",a)}}},readWorkbookFromLocalFile:function(t,e){let a=new FileReader;a.onload=function(n){let s=n.target.result,o=i.read(s,{type:"binary"});e&&e(o)},a.readAsBinaryString(t)},getOBDData:function(t){if(t.srcElement.files.length>0){let e=t.srcElement.files[0];try{this.readWorkbookFromLocalFile(e,a=>{let n=a.Sheets[g],s=i.utils.sheet_to_json(n);this.obdList=s})}catch(a){alert("导入obd编码时发生错误:"+a)}}}},mounted(){}},D=r("label",null,"附加Obd ID",-1),k={key:0},O=r("label",null,"OBD清单文件：",-1),N=r("label",null,"工单数据文件：",-1),y={key:0};function F(t,e,a,n,s,o){return c(),h("div",null,[r("div",null,[D,b(r("input",{type:"checkbox",id:"checkbox","onUpdate:modelValue":e[0]||(e[0]=l=>s.appendObdId=l)},null,512),[[x,s.appendObdId]]),s.appendObdId?(c(),h("div",k,[O,u(),r("input",{type:"file",onChange:e[1]||(e[1]=(...l)=>o.getOBDData&&o.getOBDData(...l)),accept:".xlsx"},null,32)])):f("",!0)]),N,r("input",{type:"file",onChange:e[2]||(e[2]=(...l)=>o.getData&&o.getData(...l)),accept:".bin"},null,32),s.ofsData!=null?(c(),h("div",y,[r("button",{onClick:e[3]||(e[3]=(...l)=>o.genData&&o.genData(...l))},"导出文件")])):f("",!0)])}const I=m(w,[["render",F]]),v=r("h1",{id:"尾纤码化",tabindex:"-1"},[u("尾纤码化 "),r("a",{class:"header-anchor",href:"#尾纤码化","aria-hidden":"true"},"#")],-1),B=r("h2",{id:"工单数据转xlsx",tabindex:"-1"},[u("工单数据转xlsx "),r("a",{class:"header-anchor",href:"#工单数据转xlsx","aria-hidden":"true"},"#")],-1),C=JSON.parse('{"title":"尾纤码化","description":"","frontmatter":{},"headers":[{"level":2,"title":"工单数据转xlsx","slug":"工单数据转xlsx","link":"#工单数据转xlsx","children":[]}],"relativePath":"tools/ofs-json2xlsx.md","lastUpdated":null}'),E={name:"tools/ofs-json2xlsx.md"},L=Object.assign(E,{setup(t){return(e,a)=>(c(),h("div",null,[v,B,_(I)]))}});export{C as __pageData,L as default};
